<form id="rightForm" (ngSubmit)="rightForm.form.valid && onSave()" #rightForm="ngForm"
    class="flex flex-col max-w-310 md:min-w-310 overflow-hidden max-h-screen -m-6">
    <!-- Header -->
    <div class="flex flex-0 items-center justify-between h-12 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary text-on-primary">
        <div class="text-lg font-medium head-modal">
            <span>Cập nhật phụ cấp</span>
        </div>
        <button mat-icon-button [tabIndex]="-1" (click)="onClose()">
            <i class="fa-light fa-xmark icon-size-5"></i>
        </button>
    </div>

    <div #mainns class="flex flex-col flex-auto h-modal max-h-130 overflow-y-auto">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-8 w-full min-w-0 p-6 overflow-y-auto">
            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Số quyết định </mat-label>
                <input matInput name="soqd" [(ngModel)]="data.soQd" (change)="openSoQDbyTxt($event)" placeholder="" />
                <button type="button" class="mx-1 -mr-2" (click)="onChonQuyetDinh()" color="primary" mat-flat-button>
                    <span>Chọn</span>
                </button>
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Ngày ký</mat-label>
                <input matInput [matDatepicker]="ngayky" [(ngModel)]="data.ngayky" name="ngayky" />
                <mat-datepicker-toggle matSuffix [for]="ngayky"></mat-datepicker-toggle>
                <mat-datepicker #ngayky></mat-datepicker>
            </mat-form-field>

            <div class="flex flex-col justify-center">
                <div class="mat-field-label">Người ký</div>
                <p-autoComplete name="nguoiky" [style]="{ width: '100%'}" [(ngModel)]="nguoikyQdBean"
                    [suggestions]="filteredNguoikyQd" (completeMethod)="searchNguoiky($event)"
                    (onSelect)="onSelectNguoiKy($event)" [completeOnFocus]="true" field='name' [dropdown]="true"
                    dataKey='id'>
                </p-autoComplete>
            </div>

            <div class="flex flex-col justify-center">
                <div class="mat-field-label">Chức vụ</div>
                <p-autoComplete name="chucvu" [style]="{ width: '100%'}" [(ngModel)]="chucvuQdBean"
                    [suggestions]="filteredChucvuQd" (completeMethod)="search($event)" field='name' [dropdown]="true"
                    dataKey='id'>
                </p-autoComplete>
            </div>

            <div class="flex flex-col justify-center col-span-2">
                <mat-form-field class="fuse-mat-no-subscript w-full">
                    <mat-label class="">Nội dung</mat-label>
                    <input matInput type="text" [(ngModel)]="data.noidung" id="noidung" name="noidung">
                </mat-form-field>
            </div>

            <div class="flex flex-col justify-center col-span-2">
                <div class="mat-field-label">Văn bản đính kèm</div>
                <p-fileUpload #fileForm accept="image/*,.doc,.docx,.pdf,.xls,.xlsx" class="w-full text-base"
                    chooseLabel="Chọn" (onSelect)="myUploader($event, fileForm)" cancelLabel="Hủy" [customUpload]="true"
                    [maxFileSize]="2048000" invalidFileSizeMessageSummary=""
                    invalidFileSizeMessageDetail='File Size không được quá 2 MB'>
                    <ng-template pTemplate="content">
                        <div>
                            <div *ngIf="data.fileAttach && !data.fileAttach?.deleted"
                                class="flex items-center justify-between w-full md:w-auto mt-2">
                                <div class="fuse-mat-no-subscript w-2/5">
                                    <div class="mat-field-label truncate ">{{data.fileAttach.fileName}}</div>
                                </div>

                                <div class="fuse-mat-no-subscript w-1/5">
                                    <div class="mat-field-label ">{{data.fileAttach.fileSize}} bytes</div>
                                </div>

                                <div class="flex justify-end w-1/5">

                                    <button type="button" class="mr-2" (click)="taiFileQDdinhkem(data)">
                                        <i class="fa-light fa-download icon-size-5" matTooltip="Tải"></i>
                                    </button>

                                    <button pButton icon="fa-light fa-trash-can" type="button"
                                        (click)="deleteFileQD(data.fileAttach)"></button>
                                </div>
                            </div>
                        </div>
                    </ng-template>

                </p-fileUpload>
            </div>
            <div class="flex flex-col justify-center">
                <div class="mat-field-label">Loại phụ cấp<span class="font-bold text-red-500 text-lg">*</span></div>
                <p-dropdown id="cboLoaiphucap" panelStyleClass="max-w-full" [style]="{ width: '100%'}"
                    [options]="listLoaiphucap" optionLabel="name" optionValue="id" [(ngModel)]="data.phucapId"
                    name="loaiphucap" (onChange)="changeLoaiPC($event.value)" appendTo="body" [filter]="true"
                    filterBy="name" placeholder="&nbsp;" [required]>
                </p-dropdown>
            </div>
            <div class="flex flex-col justify-center">
                <label class="">&nbsp;</label>
                <div class="flex">
                    <p-checkbox class="pl-2 self-center mr-1" name="chkHiendanghuong" [(ngModel)]="data.isDanghuong"
                        [binary]="true" inputId="chkHiendanghuong">
                    </p-checkbox>
                    <label class="mat-field-label" for="chkHiendanghuong">Hiện đang hưởng</label>
                </div>
            </div>
            <div class="flex flex-col w-full">
                <div class="mat-field-label">Hệ số</div>
                <div class="w-full" [ngClass]="{'flex justify-between': data.phantramluong}">
                    <p-dropdown id="cboHeso" panelStyleClass="max-w-full" styleClass="w-full" class="flex-grow"
                        [options]="listPhucapHeso" optionLabel="name" optionValue="id" name="heso"
                        [(ngModel)]="data.hspcId" appendTo="body" [filter]="true" placeholder="&nbsp;"
                        [disabled]="data.isTienmat" filterBy="name">
                    </p-dropdown>
                    <label *ngIf="data.phantramluong" class="mat-field-label ml-2 w-36" for="chkHiendanghuong">% hệ số
                        lương</label>
                </div>
            </div>
            <div class="flex flex-col ">
                <div class="flex">
                    <p-checkbox class="pl-2 mr-1 self-baseline" name="chkTienmat" [(ngModel)]="data.isTienmat"
                        (onChange)="checkTienmat()" [binary]="true" inputId="chkTienmat">
                    </p-checkbox>
                    <label class="mat-field-label" for="chkTienmat">PC Tiền mặt (VNĐ)</label>
                </div>
                <mat-form-field class="fuse-mat-no-subscript w-full">
                    <input matInput inputNumberFormat type="text" maxlength="18" id="txtTienmat" name="txtTienmat" [(ngModel)]="data.strTienmat"
                        [readonly]="!data.isTienmat">
                </mat-form-field>
            </div>
            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Ngày hiệu lực</mat-label>
                <input matInput [matDatepicker]="ngayhieuluc" name="ngayhieuluc" [(ngModel)]="data.ngayhl" required />
                <mat-datepicker-toggle matSuffix [for]="ngayhieuluc"></mat-datepicker-toggle>
                <mat-datepicker #ngayhieuluc></mat-datepicker>
            </mat-form-field>
            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Ngày kết thúc</mat-label>
                <input matInput [matDatepicker]="dtpNgayketthuc" name="dtpNgayketthuc" [(ngModel)]="data.ngaykt"
                    [required]="!data.isDanghuong" />
                <mat-datepicker-toggle matSuffix [for]="dtpNgayketthuc"></mat-datepicker-toggle>
                <mat-datepicker #dtpNgayketthuc></mat-datepicker>
            </mat-form-field>
            <div class="flex flex-col justify-center col-span-2">
                <mat-form-field class="fuse-mat-no-subscript w-full">
                    <mat-label class="">Ghi chú</mat-label>
                    <input matInput type="text" id="ghichu" name="ghichu" [(ngModel)]="data.ghichu">
                </mat-form-field>
            </div>
        </div>
    </div>

    <div class="flex flex-0 items-center justify-end h-12 mr-2 pr-3 pl-6 sm:pl-8 mt-2 text-on-primary">
        <div mat-dialog-actions class="h-toolbar flex justify-end">
            <button *ngIf="isNghiviec == null || isNghiviec == false" type="submit" class="mx-1 button-green" mat-flat-button>
                <i class="fa-light fa-check icon-size-5"></i>
                <span class="ml-2">Lưu</span>
            </button>

        </div>
    </div>

</form>