<form id="rightForm" (ngSubmit)="rightForm.form.valid && onSave()" #rightForm="ngForm"
    class="flex flex-col max-w-310 md:min-w-310 overflow-hidden max-h-screen -m-6">
    <!-- Header -->
    <div class="flex flex-0 items-center justify-between h-12 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary text-on-primary">
        <div class="text-lg font-medium head-modal">
            <span>Cập nhật quá trình hưởng lương</span>
        </div>
        <button mat-icon-button [tabIndex]="-1" (click)="onClose()">
            <i class="fa-light fa-xmark icon-size-5"></i>
        </button>
    </div>

    <div #mainns class="flex flex-col flex-auto h-modal max-h-130 overflow-y-auto">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-8 w-full min-w-0 p-6 overflow-y-auto">
            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Số quyết định </mat-label>
                <input matInput name="soqd" [(ngModel)]="data.soQd" (change)="openSoQDbyTxt($event)" placeholder="" />
                <button type="button" class="mx-1 -mr-2" (click)="onChonQuyetDinh()" color="primary" mat-flat-button>
                    <span>Chọn</span>
                </button>
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Ngày ký</mat-label>
                <input matInput [matDatepicker]="ngayky" [(ngModel)]="data.ngayky" name="ngayky" />
                <mat-datepicker-toggle matSuffix [for]="ngayky"></mat-datepicker-toggle>
                <mat-datepicker #ngayky></mat-datepicker>
            </mat-form-field>

            <div class="flex flex-col justify-center">
                <div class="mat-field-label">Người ký</div>
                <p-autoComplete name="nguoiky" [style]="{ width: '100%'}" [(ngModel)]="nguoikyQdBean"
                    [suggestions]="filteredNguoikyQd" (completeMethod)="searchNguoiky($event)" field='tenkhaisinh'
                    [dropdown]="true" dataKey='nsId' (onSelect)="onSelectNguoiKy($event)">
                </p-autoComplete>
            </div>

            <div class="flex flex-col justify-center">
                <div class="mat-field-label">Chức vụ</div>
                <p-autoComplete name="chucvu" [style]="{ width: '100%'}" [(ngModel)]="chucvuQdBean"
                    [suggestions]="filteredChucvuQd" (completeMethod)="search($event)" field='name' [dropdown]="true"
                    dataKey='id' [virtualScroll]="true" [itemSize]="34">
                </p-autoComplete>
            </div>

            <div class="flex flex-col justify-center col-span-2">
                <mat-form-field class="fuse-mat-no-subscript w-full">
                    <mat-label class="">Nội dung</mat-label>
                    <input matInput type="text" [(ngModel)]="data.noidung" id="noidung" name="noidung">
                </mat-form-field>
            </div>

            <div class="flex flex-col justify-center col-span-2">
                <div class="mat-field-label">Văn bản đính kèm</div>
                <p-fileUpload #fileForm accept="image/*,.doc,.docx,.pdf,.xls,.xlsx" class="w-full text-base"
                    chooseLabel="Chọn" cancelLabel="Hủy" [customUpload]="true" [maxFileSize]="102400000"
                    (onSelect)="myUploader($event, fileForm)">
                    <ng-template pTemplate="content">
                        <div>
                            <div *ngIf="data.fileQdinh && !data.fileQdinh?.deleted"
                                class="flex items-center justify-between w-full md:w-auto mt-2">
                                <div class="fuse-mat-no-subscript w-2/5">
                                    <div class="mat-field-label truncate ">{{data.fileQdinh.fileName}}</div>
                                </div>

                                <div class="fuse-mat-no-subscript w-1/5">
                                    <div class="mat-field-label ">{{data.fileQdinh.fileSize}} bytes</div>
                                </div>

                                <div class="flex justify-end w-1/5">

                                    <button type="button" class="mr-2" (click)="taiFileQDdinhkem(data)">
                                        <i class="fa-light fa-download icon-size-5" matTooltip="Tải"></i>
                                    </button>

                                    <button pButton icon="fa-light fa-trash-can" type="button"
                                        (click)="deleteFileQD(data.fileQdinh)"></button>
                                </div>
                            </div>
                        </div>
                    </ng-template>

                </p-fileUpload>
            </div>

            <mat-form-field class="fuse-mat-no-subscript w-full">
                <mat-label>Nhận lương khoán</mat-label>
                <p-checkbox matPrefix class="pl-2 self-center mr-1" name="chkNhanluongkhoan"
                    [(ngModel)]="data.ckeckLuongKhoan" (onChange)="onCheckLuongkhoan()" [binary]="true"
                    inputId="chkNhanluongkhoan">
                </p-checkbox>
                <input matInput type="text" inputNumberFormat maxlength="20" [(ngModel)]="data.strLuongkhoan" id="nhanluongkhoan"
                    name="nhanluongkhoan" [required]="data.ckeckLuongKhoan" [readonly]="!data.ckeckLuongKhoan">
                <span matSuffix>(VNĐ)</span>
            </mat-form-field>

            <div class="flex flex-col justify-center"></div>

            <mat-form-field class="fuse-mat-no-subscript w-full">
                <mat-label class="">Thang bảng lương</mat-label>
                <input matInput type="text" [(ngModel)]="data.mabangluong" id="txtThangbangluong"
                    name="txtThangbangluong"  [required]="!data.ckeckLuongKhoan">
                <button name="btnChonThangbangluong" type="button" class="mx-1 -mr-2 my-auto" [disabled]="data.ckeckLuongKhoan"
                    color="primary" mat-flat-button (click)="onChonThangLuong()">
                    <span>Chọn</span>
                </button>
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript w-full">
                <mat-label class="">Mã ngạch lương</mat-label>
                <input matInput type="text" [(ngModel)]="data.mangachluong" id="txtMangachluong" name="txtMangachluong"
                     [required]="!data.ckeckLuongKhoan">
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript w-full">
                <mat-label class="">Bậc lương</mat-label>
                <input matInput type="text" [(ngModel)]="data.bacluong" id="txtBacluong" name="txtBacluong" 
                    [required]="!data.ckeckLuongKhoan" (keydown)="onKeyDownBacluong($event)">
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript w-full">
                <mat-label class="">Hệ số lương</mat-label>
                <input matInput type="number" [(ngModel)]="data.heSo" id="txtHeso" name="txtHeso" readonly min="0"
                    [required]="!data.ckeckLuongKhoan">
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript w-full">
                <mat-label class="">Hệ số bảo lưu</mat-label>
                <input matInput type="number" [(ngModel)]="data.baoluu" id="txtHesobaoluu" name="txtHesobaoluu">
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript w-full">
                <mat-label class="">Tỷ lệ hưởng</mat-label>
                <input matInput type="number" [(ngModel)]="data.tile" id="txtTyle" name="txtTyle">
                <span matSuffix>%</span>
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Ngày hiệu lực</mat-label>
                <input matInput [matDatepicker]="ngayhieuluc" [(ngModel)]="data.ngayhieuluc"
                    (dateChange)="onChangeNgayHieuLuc()" name="ngayhieuluc" required />
                <mat-datepicker-toggle matSuffix [for]="ngayhieuluc"></mat-datepicker-toggle>
                <mat-datepicker #ngayhieuluc></mat-datepicker>
            </mat-form-field>

            <div class="flex flex-col">
                <label class="">&nbsp;</label>
                <div class="mt-2">
                    <p-checkbox class="mr-1" [(ngModel)]="data.isDanghuong" name="chkHienhuong" [binary]="true"
                        inputId="chkHienhuong">
                    </p-checkbox>
                    <label style="line-height: normal;" for="chkHienhuong">Là lương hiện hưởng</label>
                </div>
            </div>

            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Mốc tính nâng lương</mat-label>
                <input matInput [matDatepicker]="moctinhnangluong" [(ngModel)]="data.thoiGianCanCuNangL"
                    (dateChange)="onChangeMoctinhLuong()" name="moctinhnangluong" />
                <mat-datepicker-toggle matSuffix [for]="moctinhnangluong"></mat-datepicker-toggle>
                <mat-datepicker #moctinhnangluong></mat-datepicker>
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Ngày kết thúc</mat-label>
                <input matInput [matDatepicker]="dtpNgayketthuc" [(ngModel)]="data.ngayketthuc" name="dtpNgayketthuc" />
                <mat-datepicker-toggle matSuffix [for]="dtpNgayketthuc"></mat-datepicker-toggle>
                <mat-datepicker #dtpNgayketthuc></mat-datepicker>
            </mat-form-field>

            <mat-form-field class="fuse-mat-no-subscript">
                <mat-label class="">Thời gian nâng lương lần sau</mat-label>
                <input matInput [matDatepicker]="dtpThoigiannllansau" [(ngModel)]="data.moctinhnl"
                    name="dtpThoigiannllansau" />
                <mat-datepicker-toggle matSuffix [for]="dtpThoigiannllansau"></mat-datepicker-toggle>
                <mat-datepicker #dtpThoigiannllansau></mat-datepicker>
            </mat-form-field>

            <div class="flex flex-col justify-center">

                <div class="flex">
                    <p-checkbox class="self-center mr-1" [(ngModel)]="data.canhbaonl" (onChange)="onCheckKcanhbao()"
                        name="chkKhongcanhbaoNL" [binary]="true" inputId="chkKhongcanhbaoNL">
                    </p-checkbox>
                    <label style="line-height: normal;" for="chkKhongcanhbaoNL">Không cảnh báo nâng lương</label>
                </div>
                <textarea class="mt-2" rows="5" cols="30" pInputTextarea id="txtKhongcanhbaoNL" name="txtKhongcanhbaoNL"
                    placeholder="Lý do không cảnh báo" [disabled]="data.canhbaonl == null || data.canhbaonl == false"
                    [(ngModel)]="data.lydokocanhbao"></textarea>

            </div>

            <div class="flex flex-col justify-center col-span-2">
                <div class="mat-field-label">File phụ lục</div>
                <p-fileUpload #fileFormPhuluc accept="image/*,.doc,.docx,.pdf,.xls,.xlsx" class="w-full text-base"
                    chooseLabel="Chọn" cancelLabel="Hủy" [customUpload]="true" [maxFileSize]="102400000"
                    (onSelect)="myUploaderFilePhuluc($event, fileFormPhuluc)">

                    <ng-template pTemplate="content">
                        <div>
                            <div *ngIf="data.fileLuongDinhkem && !data.fileLuongDinhkem?.isdeleted"
                                class="flex items-center justify-between w-full md:w-auto mt-2">
                                <div class="fuse-mat-no-subscript w-2/5">
                                    <div class="mat-field-label truncate ">{{data.fileLuongDinhkem.fileName}}</div>
                                </div>

                                <div class="fuse-mat-no-subscript w-1/5">
                                    <div class="mat-field-label ">{{data.fileLuongDinhkem.fileSize}} bytes</div>
                                </div>

                                <div class="flex justify-end w-1/5">

                                    <button type="button" class="mr-2" (click)="taiFilePhuluc(data)">
                                        <i class="fa-light fa-download icon-size-5" matTooltip="Tải"></i>
                                    </button>

                                    <button pButton icon="fa-light fa-trash-can" type="button"
                                        (click)="deleteFilePhuluc(data.fileLuongDinhkem)"></button>
                                </div>
                            </div>
                        </div>
                    </ng-template>

                </p-fileUpload>
            </div>


        </div>
    </div>

    <div class="flex flex-0 items-center justify-end h-12 mr-2 pr-3 pl-6 sm:pl-8 mt-2 text-on-primary">
        <div mat-dialog-actions class="h-toolbar flex justify-end">
            <button *ngIf="isNghiviec == null || isNghiviec == false" type="submit" class="mx-1 button-green" mat-flat-button>
                <i class="fa-light fa-check icon-size-5"></i>
                <span class="ml-2">Lưu</span>
            </button>

        </div>
    </div>
</form>
